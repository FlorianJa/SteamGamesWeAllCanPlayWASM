@page "/"
@using Steam.Models.SteamCommunity
@using SteamGamesWeAllCanPlayWASM.Client.Components
@using SteamGamesWeAllCanPlayWASM.Client.Services
@inject AuthenticationStateProvider AuthProvider
@inject SteamService UserService

<PageTitle>Steam games we all can play</PageTitle>

<AuthorizeView>
    <Authorized>
        <SteamGamesWeAllCanPlayWASM.Client.Components.UserOverview></SteamGamesWeAllCanPlayWASM.Client.Components.UserOverview>   
        <FriendListContainer FriendList=@FriendList></FriendListContainer>
        @if (SteamId != null)
        {
            <GameBibliothek SteamId=@SteamId></GameBibliothek>
        }
    </Authorized>
    <NotAuthorized>
        Please log in first.
    </NotAuthorized>
</AuthorizeView>


@code{

    public string UserName = "";
    public string SteamId { get; set; } = null;

    public IEnumerable<PlayerSummaryModel> FriendList;

    protected override async Task OnInitializedAsync()
    {

        var authstate = await AuthProvider.GetAuthenticationStateAsync();

        if (authstate.User.Identity.Name != null)
        {
            UserName = authstate.User.Identity.Name;

            SteamId = authstate.User.Claims.FirstOrDefault(c => c.Type == "SteamId").Value;

            FriendList = await UserService.GetFriendList(SteamId);
        }
    }
}